/*! 
 Build based on melong-console 
 Time : 1754664614000 */
import{_ as t,c as i,i as s,d as e,D as a,q as n,t as h,p as o}from"../assets/pixel-entry-index.1754664614000.js";const l={props:{canvasWidth:{type:Number,default:310},canvasHeight:{type:Number,default:160},show:{type:Boolean,default:!1},puzzleScale:{type:Number,default:1},sliderSize:{type:Number,default:50},range:{type:Number,default:10},imgs:{type:Array},successText:{type:String,default:"验证通过！"},failText:{type:String,default:"验证失败，请重试"},sliderText:{type:String,default:"拖动滑块完成拼图"},px:{type:Number,default:155}},data(){return{mouseDown:!1,startWidth:50,startX:0,newX:0,pinX:this.px,pinY:0,loading:!1,isCanSlide:!1,error:!1,infoBoxShow:!1,infoText:"",infoBoxFail:!1,timer1:null,closeDown:!1,isSuccess:!1,imgIndex:-1,isSubmting:!1}},mounted(){document.body.appendChild(this.$el),document.addEventListener("mousemove",this.onRangeMouseMove,!1),document.addEventListener("mouseup",this.onRangeMouseUp,!1),document.addEventListener("touchmove",this.onRangeMouseMove,{passive:!1}),document.addEventListener("touchend",this.onRangeMouseUp,!1),this.show&&(document.body.classList.add("vue-puzzle-overflow"),this.reset())},beforeDestroy(){clearTimeout(this.timer1),document.body.removeChild(this.$el),document.removeEventListener("mousemove",this.onRangeMouseMove,!1),document.removeEventListener("mouseup",this.onRangeMouseUp,!1),document.removeEventListener("touchmove",this.onRangeMouseMove,{passive:!1}),document.removeEventListener("touchend",this.onRangeMouseUp,!1)},watch:{show(t){t?(document.body.classList.add("vue-puzzle-overflow"),this.reset()):(this.isSubmting=!1,this.isSuccess=!1,this.infoBoxShow=!1,document.body.classList.remove("vue-puzzle-overflow"))}},computed:{styleWidth(){const t=this.startWidth+this.newX-this.startX;return t<this.sliderBaseSize?this.sliderBaseSize:t>this.canvasWidth?this.canvasWidth:t},puzzleBaseSize(){return Math.round(52.5*Math.max(Math.min(this.puzzleScale,2),.2)+6)},sliderBaseSize(){return Math.max(Math.min(Math.round(this.sliderSize),Math.round(.5*this.canvasWidth)),10)}},methods:{onClose(){this.mouseDown||this.isSubmting||(clearTimeout(this.timer1),this.$emit("close"))},onCloseMouseDown(){this.closeDown=!0},onCloseMouseUp(){this.closeDown&&this.onClose(),this.closeDown=!1},onRangeMouseDown(t){this.isCanSlide&&(this.mouseDown=!0,this.startWidth=this.$refs["range-slider"].clientWidth,this.newX=t.clientX||t.changedTouches[0].clientX,this.startX=t.clientX||t.changedTouches[0].clientX)},onRangeMouseMove(t){this.mouseDown&&(t.preventDefault(),this.newX=t.clientX||t.changedTouches[0].clientX)},onRangeMouseUp(){this.mouseDown&&(this.mouseDown=!1,this.submit())},init(t){if(this.loading&&!t)return;this.loading=!0,this.isCanSlide=!1;const i=this.$refs.canvas1,s=this.$refs.canvas2,e=this.$refs.canvas3,a=i.getContext("2d"),n=s.getContext("2d"),h=e.getContext("2d"),o=navigator.userAgent.indexOf("Firefox")>=0&&navigator.userAgent.indexOf("Windows")>=0,l=document.createElement("img");if(a.fillStyle="rgba(255,255,255,1)",h.fillStyle="rgba(255,255,255,1)",a.clearRect(0,0,this.canvasWidth,this.canvasHeight),n.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.pinX=this.getRandom(this.puzzleBaseSize,this.canvasWidth-this.puzzleBaseSize-20),this.pinY=this.getRandom(20,this.canvasHeight-this.puzzleBaseSize-20),l.crossOrigin="anonymous",l.onload=()=>{const[t,i,s,e]=this.makeImgSize(l);a.save(),this.paintBrick(a),a.closePath(),o?(a.clip(),a.save(),a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowColor="#000",a.shadowBlur=3,a.fill(),a.restore()):(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowColor="#000",a.shadowBlur=3,a.fill(),a.clip()),a.drawImage(l,t,i,s,e),h.fillRect(0,0,this.canvasWidth,this.canvasHeight),h.drawImage(l,t,i,s,e),a.globalCompositeOperation="source-atop",this.paintBrick(a),a.arc(this.pinX+Math.ceil(this.puzzleBaseSize/2),this.pinY+Math.ceil(this.puzzleBaseSize/2),1.2*this.puzzleBaseSize,0,2*Math.PI,!0),a.closePath(),a.shadowColor="rgba(255, 255, 255, .8)",a.shadowOffsetX=-1,a.shadowOffsetY=-1,a.shadowBlur=Math.min(Math.ceil(8*this.puzzleScale),12),a.fillStyle="#ffffaa",a.fill();const c=a.getImageData(this.pinX-3,this.pinY-20,this.pinX+this.puzzleBaseSize+5,this.pinY+this.puzzleBaseSize+5);n.putImageData(c,0,this.pinY-20),a.restore(),a.clearRect(0,0,this.canvasWidth,this.canvasHeight),a.save(),this.paintBrick(a),a.globalAlpha=.8,a.fillStyle="#ffffff",a.fill(),a.restore(),a.save(),a.globalCompositeOperation="source-atop",this.paintBrick(a),a.arc(this.pinX+Math.ceil(this.puzzleBaseSize/2),this.pinY+Math.ceil(this.puzzleBaseSize/2),1.2*this.puzzleBaseSize,0,2*Math.PI,!0),a.shadowColor="#000",a.shadowOffsetX=2,a.shadowOffsetY=2,a.shadowBlur=16,a.fill(),a.restore(),a.save(),a.globalCompositeOperation="destination-over",a.drawImage(l,t,i,s,e),a.restore(),this.loading=!1,this.isCanSlide=!0},l.onerror=()=>{this.init(!0)},!t&&this.imgs&&this.imgs.length){let t=this.getRandom(0,this.imgs.length-1);t===this.imgIndex&&(t===this.imgs.length-1?t=0:t++),this.imgIndex=t,l.src=this.imgs[t]}else l.src=this.makeImgWithCanvas()},getRandom:(t,i)=>Math.ceil(Math.random()*(i-t)+t),makeImgSize(t){const i=t.width/t.height;let s=0,e=0,a=0,n=0;return i>this.canvasWidth/this.canvasHeight?(n=this.canvasHeight,a=i*n,e=0,s=(this.canvasWidth-a)/2):(a=this.canvasWidth,n=a/i,s=0,e=(this.canvasHeight-n)/2),[s,e,a,n]},paintBrick(t){const i=Math.ceil(15*this.puzzleScale);t.beginPath(),t.moveTo(this.pinX,this.pinY),t.lineTo(this.pinX+i,this.pinY),t.arcTo(this.pinX+i,this.pinY-i/2,this.pinX+i+i/2,this.pinY-i/2,i/2),t.arcTo(this.pinX+i+i,this.pinY-i/2,this.pinX+i+i,this.pinY,i/2),t.lineTo(this.pinX+i+i+i,this.pinY),t.lineTo(this.pinX+i+i+i,this.pinY+i),t.arcTo(this.pinX+i+i+i+i/2,this.pinY+i,this.pinX+i+i+i+i/2,this.pinY+i+i/2,i/2),t.arcTo(this.pinX+i+i+i+i/2,this.pinY+i+i,this.pinX+i+i+i,this.pinY+i+i,i/2),t.lineTo(this.pinX+i+i+i,this.pinY+i+i+i),t.lineTo(this.pinX,this.pinY+i+i+i),t.lineTo(this.pinX,this.pinY+i+i),t.arcTo(this.pinX+i/2,this.pinY+i+i,this.pinX+i/2,this.pinY+i+i/2,i/2),t.arcTo(this.pinX+i/2,this.pinY+i,this.pinX,this.pinY+i,i/2),t.lineTo(this.pinX,this.pinY)},makeImgWithCanvas(){const t=document.createElement("canvas"),i=t.getContext("2d");t.width=this.canvasWidth,t.height=this.canvasHeight,i.fillStyle="rgb(".concat(this.getRandom(100,255),",").concat(this.getRandom(100,255),",").concat(this.getRandom(100,255),")"),i.fillRect(0,0,this.canvasWidth,this.canvasHeight);for(let s=0;s<12;s++)if(i.fillStyle="rgb(".concat(this.getRandom(100,255),",").concat(this.getRandom(100,255),",").concat(this.getRandom(100,255),")"),i.strokeStyle="rgb(".concat(this.getRandom(100,255),",").concat(this.getRandom(100,255),",").concat(this.getRandom(100,255),")"),this.getRandom(0,2)>1)i.save(),i.rotate(this.getRandom(-90,90)*Math.PI/180),i.fillRect(this.getRandom(-20,t.width-20),this.getRandom(-20,t.height-20),this.getRandom(10,t.width/2+10),this.getRandom(10,t.height/2+10)),i.restore();else{i.beginPath();const s=this.getRandom(-Math.PI,Math.PI);i.arc(this.getRandom(0,t.width),this.getRandom(0,t.height),this.getRandom(10,t.height/2+10),s,s+1.5*Math.PI),i.closePath(),i.fill()}return t.toDataURL("image/png")},submit(){this.isSubmting=!0;const t=Math.abs(this.pinX-(this.styleWidth-this.sliderBaseSize)+(this.puzzleBaseSize-this.sliderBaseSize)*((this.styleWidth-this.sliderBaseSize)/(this.canvasWidth-this.sliderBaseSize))-3);t<this.range?(this.infoText=this.successText,this.infoBoxFail=!1,this.infoBoxShow=!0,this.isCanSlide=!1,this.isSuccess=!0,clearTimeout(this.timer1),this.timer1=setTimeout((()=>{this.isSubmting=!1,this.$emit("success",t)}),800)):(this.infoText=this.failText,this.infoBoxFail=!0,this.infoBoxShow=!0,this.isCanSlide=!1,this.$emit("fail",t),clearTimeout(this.timer1),this.timer1=setTimeout((()=>{this.isSubmting=!1,this.reset()}),800))},resetState(){this.infoBoxFail=!1,this.infoBoxShow=!1,this.isCanSlide=!1,this.isSuccess=!1,this.startWidth=this.sliderBaseSize,this.startX=0,this.newX=0},reset(){this.isSubmting||(this.resetState(),this.init())}}},c=["width","height"],d=["width","height"],r=["width","height"],u={class:"auth-control_"},p={class:"range-text"};const g=t(l,[["render",function(t,l,g,m,v,f){return s(),i("div",{class:n(["vue-puzzle-vcode",{show_:g.show}]),onMousedown:l[5]||(l[5]=(...t)=>f.onCloseMouseDown&&f.onCloseMouseDown(...t)),onMouseup:l[6]||(l[6]=(...t)=>f.onCloseMouseUp&&f.onCloseMouseUp(...t)),onTouchstart:l[7]||(l[7]=(...t)=>f.onCloseMouseDown&&f.onCloseMouseDown(...t)),onTouchend:l[8]||(l[8]=(...t)=>f.onCloseMouseUp&&f.onCloseMouseUp(...t))},[e("div",{class:"vue-auth-box_",onMousedown:l[3]||(l[3]=o((()=>{}),["stop"])),onTouchstart:l[4]||(l[4]=o((()=>{}),["stop"]))},[e("div",{class:"auth-body_",style:a("height: ".concat(g.canvasHeight,"px"))},[e("canvas",{ref:"canvas1",width:g.canvasWidth,height:g.canvasHeight,style:a("width:".concat(g.canvasWidth,"px;height:").concat(g.canvasHeight,"px"))},null,12,c),e("canvas",{ref:"canvas3",class:n(["auth-canvas3_",{show:v.isSuccess}]),width:g.canvasWidth,height:g.canvasHeight,style:a("width:".concat(g.canvasWidth,"px;height:").concat(g.canvasHeight,"px"))},null,14,d),e("canvas",{width:f.puzzleBaseSize,class:"auth-canvas2_",height:g.canvasHeight,ref:"canvas2",style:a("width:".concat(f.puzzleBaseSize,"px;height:").concat(g.canvasHeight,"px;transform:translateX(").concat(f.styleWidth-f.sliderBaseSize-(f.puzzleBaseSize-f.sliderBaseSize)*((f.styleWidth-f.sliderBaseSize)/(g.canvasWidth-f.sliderBaseSize)),"px)"))},null,12,r),e("div",{class:n(["loading-box_",{hide_:!v.loading}])},l[9]||(l[9]=[e("div",{class:"loading-gif_"},[e("span"),e("span"),e("span"),e("span"),e("span")],-1)]),2),e("div",{class:n(["info-box_",{show:v.infoBoxShow},{fail:v.infoBoxFail}])},h(v.infoText),3),e("div",{class:n(["flash_",{show:v.isSuccess}]),style:a("transform: translateX(".concat(v.isSuccess?"".concat(g.canvasWidth+.578*g.canvasHeight,"px"):"-".concat(.578*g.canvasHeight,"px"),") skew(-30deg, 0);"))},null,6),e("i",{onClick:l[0]||(l[0]=(...t)=>f.reset&&f.reset(...t)),class:"bi bi-arrow-counterclockwise reset_"})],4),e("div",u,[e("div",{class:"range-box",style:a("height:".concat(f.sliderBaseSize,"px"))},[e("div",p,h(g.sliderText),1),e("div",{class:"range-slider",ref:"range-slider",style:a("width:".concat(f.styleWidth,"px"))},[e("div",{class:n(["range-btn",{isDown:v.mouseDown}]),style:a("width:".concat(f.sliderBaseSize,"px")),onMousedown:l[1]||(l[1]=t=>f.onRangeMouseDown(t)),onTouchstart:l[2]||(l[2]=t=>f.onRangeMouseDown(t))},l[10]||(l[10]=[e("div",null,null,-1),e("div",null,null,-1),e("div",null,null,-1)]),38)],4)],4)])],32)],34)}]]);export{g as default};
