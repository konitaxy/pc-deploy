/*! 
 Build based on gin-vue-admin 
 Time : 1754566973000 */
var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,u=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,o=(e,a,t)=>new Promise(((l,u)=>{var o=e=>{try{i(t.next(e))}catch(a){u(a)}},r=e=>{try{i(t.throw(e))}catch(a){u(a)}},i=e=>e.done?l(e.value):Promise.resolve(e.value).then(o,r);i((t=t.apply(e,a)).next())}));import{g as r,d as i,c as d,u as s,a as n}from"./pixel-authority.17545669730002.js";import y from"./pixel-menus.1754566973000.js";import h from"./pixel-apis.1754566973000.js";import v from"./pixel-datas.1754566973000.js";import{w as p}from"./pixel-warningBar.1754566973000.js";import{r as c,b as m,o as f,c as I,f as b,d as g,w,g as _,l as x,e as k,Y as C,h as N}from"../gva/pixel-index.1754566973000.js";import"./pixel-authorityBtn.1754566973000.js";import"./pixel-api.17545669730002.js";const V={class:"authority"},j={class:"gva-table-box"},z={class:"gva-btn-list"},O={class:"dialog-footer"},A=Object.assign({name:"Authority"},{setup(e){const A=c([{authorityId:"0",authorityName:"根角色"}]),P=c(!1),S=c("add"),U=c({}),B=c("新增角色"),q=c(!1),D=c(!1),E=c({}),R=c({authorityId:"",authorityName:"",parentId:"0"}),F=c({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(e,a,t)=>/^[0-9]*[1-9][0-9]*$/.test(a)?t():t(new Error("请输入正整数")),trigger:"blur"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择请求方式",trigger:"blur"}]}),T=c(1),Y=c(0),$=c(999),G=c([]),H=c({}),J=()=>o(this,null,(function*(){const e=yield r(((e,o)=>{for(var r in o||(o={}))t.call(o,r)&&u(e,r,o[r]);if(a)for(var r of a(o))l.call(o,r)&&u(e,r,o[r]);return e})({page:T.value,pageSize:$.value},H.value));0===e.code&&(G.value=e.data.list,Y.value=e.data.total,T.value=e.data.page,$.value=e.data.pageSize)}));J();const K=(e,a)=>{U.value[e]=a},L=c(null),M=c(null),Q=c(null),W=(e,a)=>{const t=[L,M,Q];a&&t[a].value.needConfirm&&(t[a].value.enterAndNext(),t[a].value.needConfirm=!1)},X=e=>{C.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>o(this,null,(function*(){0===(yield i({authorityId:e.authorityId})).code&&(N({type:"success",message:"删除成功!"}),1===G.value.length&&T.value>1&&T.value--,J())})))).catch((()=>{N({type:"info",message:"已取消删除"})}))},Z=c(null),ee=()=>{Z.value&&Z.value.resetFields(),R.value={authorityId:"",authorityName:"",parentId:"0"}},ae=()=>{ee(),q.value=!1,D.value=!1},te=()=>{if("0"===R.value.authorityId)return N({type:"error",message:"角色id不能为0"}),!1;Z.value.validate((e=>o(this,null,(function*(){if(e){switch(S.value){case"add":0===(yield n(R.value)).code&&(N({type:"success",message:"添加成功!"}),J(),ae());break;case"edit":0===(yield s(R.value)).code&&(N({type:"success",message:"添加成功!"}),J(),ae());break;case"copy":{const e={authority:{authorityId:"string",authorityName:"string",datauthorityId:[],parentId:"string"},oldAuthorityId:0};e.authority.authorityId=R.value.authorityId,e.authority.authorityName=R.value.authorityName,e.authority.parentId=R.value.parentId,e.authority.dataAuthorityId=E.value.dataAuthorityId,e.oldAuthorityId=E.value.authorityId;0===(yield d(e)).code&&(N({type:"success",message:"复制成功！"}),J())}}ee(),q.value=!1}}))))},le=()=>{A.value=[{authorityId:"0",authorityName:"根角色"}],ue(G.value,A.value,!1)},ue=(e,a,t)=>{R.value.authorityId=String(R.value.authorityId),e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,disabled:t||e.authorityId===R.value.authorityId,children:[]};ue(e.children,l.children,t||e.authorityId===R.value.authorityId),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName,disabled:t||e.authorityId===R.value.authorityId};a.push(l)}}))},oe=e=>{ee(),B.value="新增角色",S.value="add",R.value.parentId=e,le(),q.value=!0};return(e,a)=>{const t=m("el-button"),l=m("el-table-column"),u=m("el-table"),o=m("el-cascader"),r=m("el-form-item"),i=m("el-input"),d=m("el-form"),s=m("el-dialog"),n=m("el-tab-pane"),c=m("el-tabs"),C=m("el-drawer");return f(),I("div",V,[b(p,{title:"注：右上角头像下拉可切换角色"}),g("div",j,[g("div",z,[b(t,{size:"small",type:"primary",icon:"plus",onClick:a[0]||(a[0]=e=>oe("0"))},{default:w((()=>a[6]||(a[6]=[_("新增角色")]))),_:1})]),b(u,{data:G.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:w((()=>[b(l,{label:"角色ID","min-width":"180",prop:"authorityId"}),b(l,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),b(l,{align:"left",label:"操作",width:"460"},{default:w((e=>[b(t,{icon:"setting",size:"small",type:"text",onClick:a=>{return t=e.row,P.value=!0,void(U.value=t);var t}},{default:w((()=>a[7]||(a[7]=[_("设置权限")]))),_:2},1032,["onClick"]),b(t,{icon:"plus",size:"small",type:"text",onClick:a=>oe(e.row.authorityId)},{default:w((()=>a[8]||(a[8]=[_("新增子角色")]))),_:2},1032,["onClick"]),b(t,{icon:"copy-document",size:"small",type:"text",onClick:a=>(e=>{le(),B.value="拷贝角色",S.value="copy";for(const a in R.value)R.value[a]=e[a];E.value=e,q.value=!0})(e.row)},{default:w((()=>a[9]||(a[9]=[_("拷贝")]))),_:2},1032,["onClick"]),b(t,{icon:"edit",size:"small",type:"text",onClick:a=>(e=>{le(),B.value="编辑角色",S.value="edit";for(const a in R.value)R.value[a]=e[a];le(),q.value=!0})(e.row)},{default:w((()=>a[10]||(a[10]=[_("编辑")]))),_:2},1032,["onClick"]),b(t,{icon:"delete",size:"small",type:"text",onClick:a=>X(e.row)},{default:w((()=>a[11]||(a[11]=[_("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),b(s,{modelValue:q.value,"onUpdate:modelValue":a[4]||(a[4]=e=>q.value=e),title:B.value},{footer:w((()=>[g("div",O,[b(t,{size:"small",onClick:ae},{default:w((()=>a[12]||(a[12]=[_("取 消")]))),_:1}),b(t,{size:"small",type:"primary",onClick:te},{default:w((()=>a[13]||(a[13]=[_("确 定")]))),_:1})])])),default:w((()=>[b(d,{ref_key:"authorityForm",ref:Z,model:R.value,rules:F.value,"label-width":"80px"},{default:w((()=>[b(r,{label:"父级角色",prop:"parentId"},{default:w((()=>[b(o,{modelValue:R.value.parentId,"onUpdate:modelValue":a[1]||(a[1]=e=>R.value.parentId=e),style:{width:"100%"},disabled:"add"==S.value,options:A.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),b(r,{label:"角色ID",prop:"authorityId"},{default:w((()=>[b(i,{modelValue:R.value.authorityId,"onUpdate:modelValue":a[2]||(a[2]=e=>R.value.authorityId=e),disabled:"edit"==S.value,autocomplete:"off"},null,8,["modelValue","disabled"])])),_:1}),b(r,{label:"角色姓名",prop:"authorityName"},{default:w((()=>[b(i,{modelValue:R.value.authorityName,"onUpdate:modelValue":a[3]||(a[3]=e=>R.value.authorityName=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),P.value?(f(),x(C,{key:0,modelValue:P.value,"onUpdate:modelValue":a[5]||(a[5]=e=>P.value=e),"with-header":!1,size:"40%",title:"角色配置"},{default:w((()=>[b(c,{"before-leave":W,class:"role-box",type:"border-card"},{default:w((()=>[b(n,{label:"角色菜单"},{default:w((()=>[b(y,{ref_key:"menus",ref:L,row:U.value,onChangeRow:K},null,8,["row"])])),_:1}),b(n,{label:"角色api"},{default:w((()=>[b(h,{ref_key:"apis",ref:M,row:U.value,onChangeRow:K},null,8,["row"])])),_:1}),b(n,{label:"资源权限"},{default:w((()=>[b(v,{ref_key:"datas",ref:Q,authority:G.value,row:U.value,onChangeRow:K},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):k("",!0)])}}});export{A as default};
