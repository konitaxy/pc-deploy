/*! 
 Build based on gin-vue-admin 
 Time : 1754292185000 */
var e=(e,a,t)=>new Promise(((s,o)=>{var r=e=>{try{n(t.next(e))}catch(a){o(a)}},l=e=>{try{n(t.throw(e))}catch(a){o(a)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,l);n((t=t.apply(e,a)).next())}));import{e as a}from"./pixel-api.17542921850002.js";import{s as t,r as s,b as o,o as r,c as l,d as n,f as c,w as i,g as p,h as d}from"../gva/pixel-index.1754292185000.js";const u={class:"clearflex"},h=Object.assign({name:"Apis"},{props:{row:{default:function(){return{}},type:Object}},setup(h,{expose:y}){const f=h,v=s({children:"children",label:"description"}),m=s([]),b=s([]),x=s("");(()=>{e(this,null,(function*(){const e=(yield a()).data.apis;m.value=I(e);const s=yield(o={authorityId:f.row.authorityId},t({url:"/casbin/getPolicyPathByAuthorityId",method:"post",data:o}));var o;x.value=f.row.authorityId,b.value=[],s.data.paths&&s.data.paths.forEach((e=>{b.value.push("p:"+e.path+"m:"+e.method)}))}))})();const g=s(!1),k=()=>{g.value=!0},I=e=>{const a={};e&&e.forEach((e=>{e.onlyId="p:"+e.path+"m:"+e.method,Object.prototype.hasOwnProperty.call(a,e.apiGroup)?a[e.apiGroup].push(e):Object.assign(a,{[e.apiGroup]:[e]})}));const t=[];for(const s in a){const e={ID:s,description:s+"组",children:a[s]};t.push(e)}return t},w=s(null),j=()=>e(this,null,(function*(){const e=w.value.getCheckedNodes(!0);var a=[];e&&e.forEach((e=>{var t={path:e.path,method:e.method};a.push(t)}));var s;0===(yield(s={authorityId:x.value,casbinInfos:a},t({url:"/casbin/updateCasbin",method:"post",data:s}))).code&&d({type:"success",message:"api设置成功"})}));return y({needConfirm:g,enterAndNext:()=>{j()}}),(e,a)=>{const t=o("el-button"),s=o("el-tree");return r(),l("div",null,[n("div",u,[c(t,{class:"fl-right",size:"small",type:"primary",onClick:j},{default:i((()=>a[0]||(a[0]=[p("确 定")]))),_:1})]),c(s,{ref_key:"apiTree",ref:w,data:m.value,"default-checked-keys":b.value,props:v.value,"default-expand-all":"","highlight-current":"","node-key":"onlyId","show-checkbox":"",onCheck:k},null,8,["data","default-checked-keys","props"])])}}});export{h as default};
